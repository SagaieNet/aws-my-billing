<?php
date_default_timezone_set('Asia/Tokyo');

# require aws sdk
require 'AWSSDKforPHP/vendor/autoload.php';

# include Awstar
include __DIR__ . '/../awstar/awstar_autoload.php';

# autoload classes
include __DIR__ . '/../autoload.php';

$awsmybillingCommon = new AwsmybillingCommon();
$awsmybillingRRD = new AwsmybillingRRD();

# 情報を取得するサービス一覧を取得する
$serviceList = $awsmybillingCommon->getServiceList();

# Servicesメニュー用のhtmlを生成する
$htmlServices = '';
foreach($serviceList as $serviceName){
  if( $serviceName !== 'total'){
    $htmlServices .= "<li><a href='./index.html?service=$serviceName'>$serviceName</a></li>";
  }
}

# InstanceListTables用のhtmlを生成する
$htmlInstanceList = '';
$instanceList = AwstarEc2::getInstanceList(Aws\Common\Enum\Region::TOKYO,'<tr><td>%Tag{Name}</td><td>%InstanceId</td><td>%InstanceType</td><td>%LaunchTime</td><td>%StatusName</td></tr>');
foreach($instanceList as $instance){
  $htmlInstanceList .= $instance;
}

?>
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>AWS/MyBilling</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Loading Flat UI -->
    <link href="css/flat-ui.css" rel="stylesheet">

    <!-- Loading AWS/MyBilling -->
    <link href="css/awsmybilling.css" rel="stylesheet">

    <!-- Loading dataTables -->
    <link href="datatables/css/jquery.dataTables.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <h1>AWS/MyBilling</h1>

      <div class="row">
        <div class="span12">
          <div class="navbar navbar-inverse">
            <div class="navbar-inner">
              <div class="container">
                <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <div class="nav-collapse collapse">
                  <ul class="nav">
                    <li class="active">
                      <a href="./index.html">
                        Overview
                      </a>
                    </li>
                    <li>
                      <a href="#">
                        Services
                        <span class="navbar-unread">1</span>
                      </a>
                      <ul>
                        <?php echo $htmlServices; ?>
                      </ul> <!-- /Sub menu -->
                    </li>
                    <li>
                      <a href="#">
                        PriceList
                        <span class="navbar-unread">1</span>
                      </a>
                    </li>
                  </ul>
                </div><!--/.nav-collapse -->
              </div>
            </div>
          </div>
        </div>
      </div> <!-- /row -->
    </div> <!-- /container -->

    <div class="container main-graph">
      <div class="row">
        <div class="span12">
          <img src="graph.php" class="img-polaroid">
        </div>
      </div>
    </div> <!-- /container -->

    <div class="container instance_list">
      <div class="row">
        <div class="span12">
        <h3 class="panel-title">Instance List</h3>
          <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="instance_list_table">
            <thead>
              <th>Name Tag</th>
              <th>Instance Id</th>
              <th>Instance Type</th>
              <th>Launch Time</th>
              <th>Status</th>
            </thead>
            <tbody>
              <?php echo $htmlInstanceList; ?>
            </tbody>
          </table>
        </div>
      </div>
    </div> <!-- /container -->

    <footer>
      <div class="container">
        <div class="row">
          <div class="span7">
            <h3 class="footer-title">Description</h3>
            <p>グラフの情報はAmazon CloudWatchから取得しています。請求情報に関しては約4時間間隔で更新される為、グラフの更新も約4時間度となります。</p>

            <p class="pvl">
              <a href="https://twitter.com/share" class="twitter-share-button" data-url="https://github.com/kurimon/awsmybilling/" data-text="Flat UI Free - PSD&amp;HTML User Interface Kit" data-via="designmodo" data-size="large">Tweet</a>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
            </p>

          </div> <!-- /span8 -->

          <div class="span5">
            <div class="footer-banner">
              <h3 class="footer-title">AWS/MyBilling</h3>
              <ul>
                <li>○ 2013.3.29 ○</li>
                <li>Version: 1.2</li>
                <li>AWSの請求情報をいい感じに表示するツール</li>
                <li>Autor:Kurimon, Mizo</li>
              </ul>
              Github: <a href="https://github.com/kurimon/awsmybilling" target="_blank">kurimon/awsmybilling</a>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Load JS here for greater good =============================-->
    <script src="js/jquery-1.8.2.min.js"></script>
    <script src="js/jquery-ui-1.10.0.custom.min.js"></script>
    <script src="js/jquery.dropkick-1.0.0.js"></script>
    <script src="js/custom_checkbox_and_radio.js"></script>
    <script src="js/custom_radio.js"></script>
    <script src="js/jquery.tagsinput.js"></script>
    <script src="js/bootstrap-tooltip.js"></script>
    <script src="js/jquery.placeholder.js"></script>
    <script src="http://vjs.zencdn.net/c/video.js"></script>
    <script src="js/application.js"></script>
    <script src="datatables/js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" charset="utf-8">
      /* Table initialisation */
      $(document).ready(function() {
          $('#instance_list_table').dataTable( {
              "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>"
          } );
      } );
		</script>
      
      
    </script>
    <!--[if lt IE 8]>
      <script src="js/icon-font-ie7.js"></script>
      <script src="js/icon-font-ie7-24.js"></script>
    <![endif]-->
  </body>
</html>
